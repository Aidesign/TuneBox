var app=angular.module("TuneBox",["ngResource","ngRoute"]);app.config(["$routeProvider",function(e){e.when("/",{templateUrl:"partials/home.view.html",controller:"homeCtrl"}).when("/register",{templateUrl:"partials/register.view.html",controller:"registerCtrl"}).when("/login",{templateUrl:"partials/login.view.html",controller:"loginCtrl"}).when("/room",{templateUrl:"partials/room.html"}).when("/profile/",{templateUrl:"partials/profile.view.html",controller:"profileCtrl"}).otherwise({redirectTo:"/"})}]);(function(){angular.module("TuneBox").controller("homeCtrl",e);e.$inject=["$scope","authentication"];function e(e,n){}})();(function(){angular.module("TuneBox").controller("registerCtrl",e);e.$inject=["$scope","authentication","$location"];function e(e,n,o){if(n.isLoggedIn()){o.path("/")}e.register=function(){n.register(e.user).success(function(e){o.path("/")}).error(function(n){e.showError=true;e.error=n.message})}}})();(function(){angular.module("TuneBox").service("authentication",e);e.$inject=["$window","$http"];function e(e,n){var o=function(n){e.localStorage["tunebox-token"]=n};var t=function(){return e.localStorage["tunebox-token"]};var r=function(){e.localStorage.removeItem("tunebox-token")};var i=function(e){return n.post("api/login",e).success(function(e){o(e.token)})};var a=function(e){return n.post("api/register",e).success(function(e){o(e.token)})};var u=function(){var n=t();if(n){var o=JSON.parse(e.atob(n.split(".")[1]));return o.exp>Date.now()/1e3}else{return null}};var l=function(){if(u()){var n=t();var o=JSON.parse(e.atob(n.split(".")[1]));return o}else{return false}};var c=function(){var e=l();var n={_id:e._id,name:e.name,email:e.email,joined:e.joined,organization:e.organization,homePage:e.homePage,premium:e.premium,privateLimit:e.privateLimit,publicLimit:e.publicLimit};return n};return{saveToken:o,getToken:t,logout:r,login:i,register:a,isLoggedIn:u,getUserInfo:l,getUserObject:c}}})();(function(){angular.module("TuneBox").controller("loginCtrl",e);e.$inject=["$scope","authentication","$location"];function e(e,n,o){if(n.isLoggedIn()){o.path("/")}e.error="";e.login=function(){n.login(e.user).success(function(e){o.path("/")}).error(function(n){e.error=n.message})}}})();(function(){angular.module("TuneBox").controller("navigationCtrl",e);e.$inject=["$scope","authentication","$location"];function e(e,n,o){if(info=n.getUserInfo()){e.showLogin=false;e.test="Current user: "+info.email}else{e.showLogin=true}e.logout=function(){n.logout();e.test="logged out!";e.showLogin=true;o.path("/")}}})();(function(){angular.module("TuneBox").controller("profileCtrl",e);e.$inject=["$scope","authentication","$location","profileService","$timeout"];function e(e,n,o,t,r){if(!n.isLoggedIn()){o.path("/")}e.user=n.getUserObject();e.edit=function(n){i();switch(n){case"personalInfo":e.editPersonalInfo=true;break;case"organizationInfo":e.editOrganizationInfo=true;break}};e.save=function(o){t.saveProfile(e.user).success(function(o){n.saveToken(o.token);e.showSuccess=true;i();r(function(){e.showSuccess=false},4e3)}).error(function(n){e.showError=true;e.error=n.message})};e.cancel=function(){i()};var i=function(){e.showError=false;e.editPersonalInfo=false;e.editOrganizationInfo=false;e.user=n.getUserObject()}}})();(function(){angular.module("TuneBox").service("profileService",e);e.$inject=["$http"];function e(e){var n=function(n){var o="/api/users/"+n._id;return e.put(o,n)};return{saveProfile:n}}})();