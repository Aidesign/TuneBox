var app=angular.module("TuneBox",["ngResource","ngRoute"]);app.config(["$routeProvider",function(e){e.when("/",{templateUrl:"partials/home.view.html",controller:"homeCtrl"}).when("/register",{templateUrl:"partials/register.view.html",controller:"registerCtrl"}).when("/login",{templateUrl:"partials/login.view.html",controller:"loginCtrl"}).when("/room",{templateUrl:"partials/room.view.html",controller:"youtubeCtrl"}).when("/create-room",{templateUrl:"partials/create-room.html",controller:"roomcreationCtrl"}).when("/rooms",{templateUrl:"partials/rooms.html",controller:"roomlistingCtrl"}).when("/room/:roomid",{templateUrl:"partials/room.view.html",controller:"roomCtrl"}).otherwise({redirectTo:"/"})}]);(function(){angular.module("TuneBox").controller("homeCtrl",e);e.$inject=["$scope","authentication"];function e(e,o){}})();(function(){angular.module("TuneBox").controller("registerCtrl",e);e.$inject=["$scope","authentication","$location"];function e(e,o,t){if(o.isLoggedIn()){t.path("/")}e.register=function(){o.register(e.user).success(function(e){t.path("/")}).error(function(o){e.error=o})}}})();(function(){angular.module("TuneBox").service("authentication",e);e.$inject=["$window","$http"];function e(e,o){var t=function(o){e.localStorage["tunebox-token"]=o};var n=function(){return e.localStorage["tunebox-token"]};var r=function(){e.localStorage.removeItem("tunebox-token")};var i=function(e){return o.post("api/login",e).success(function(e){t(e.token)})};var l=function(e){return o.post("api/register",e).success(function(e){t(e.token)})};var a=function(){var o=n();if(o){var t=JSON.parse(e.atob(o.split(".")[1]));return t.exp>Date.now()/1e3}else{return null}};var s=function(){if(a()){var o=n();var t=JSON.parse(e.atob(o.split(".")[1]));return t}else{return false}};return{saveToken:t,getToken:n,logout:r,login:i,register:l,isLoggedIn:a,getUserInfo:s}}})();(function(){angular.module("TuneBox").controller("loginCtrl",e);e.$inject=["$scope","authentication","$location"];function e(e,o,t){if(o.isLoggedIn()){t.path("/")}e.error="";e.login=function(){o.login(e.user).success(function(e){t.path("/")}).error(function(o){e.error=o.message})}}})();(function(){angular.module("TuneBox").controller("navigationCtrl",e);e.$inject=["$scope","authentication"];function e(e,o){if(info=o.getUserInfo()){e.showLogin=false;e.test="Current user: "+info.email}else{e.showLogin=true}e.logout=function(){o.logout();e.test="logged out!";e.showLogin=true}}})();(function(){angular.module("TuneBox").run(function(){var e=document.createElement("script");e.src="https://www.youtube.com/iframe_api";var o=document.getElementsByTagName("script")[0];o.parentNode.insertBefore(e,o)}).config(["$httpProvider",function(e){delete e.defaults.headers.common["X-Requested-With"]}]).service("youtubeService",e);e.$inject=["$window","$rootScope","$log"];function e(e,o,t){var n=this;var r={ready:false,player:null,playerId:null,videoId:null,videoTitle:null,playerHeight:"100%",playerWidth:"100%",state:"stopped"};var i=[];var l=[];e.onYouTubeIframeAPIReady=function(){t.info("Youtube API is ready");r.ready=true;n.bindPlayer("placeholder");n.loadPlayer();o.$apply()};this.bindPlayer=function(e){t.info("Binding to "+e);r.playerId=e};this.createPlayer=function(){t.info("Creating a new Youtube player for DOM id "+r.playerId+" and video "+r.videoId);return new YT.Player(r.playerId,{height:r.playerHeight,width:r.playerWidth,playerVars:{rel:0,showinfo:0}})};this.loadPlayer=function(){if(r.ready&&r.playerId){if(r.player){r.player.destroy()}r.player=n.createPlayer()}};this.launchPlayer=function(e,o){r.player.loadVideoById(e);r.videoId=e;r.videoTitle=o;return r};this.listResults=function(e,o){if(!o){i.length=0}for(var t=e.items.length-1;t>=0;t--){i.push({id:e.items[t].id.videoId,title:e.items[t].snippet.title,description:e.items[t].snippet.description,thumbnail:e.items[t].snippet.thumbnails.default.url,author:e.items[t].snippet.channelTitle})}return i};this.archiveVideo=function(e){l.unshift(e);return l};this.getYoutube=function(){return r};this.getResults=function(){return i};this.getHistory=function(){return l}}})();(function(){angular.module("TuneBox").controller("youtubeCtrl",e);e.$inject=["$scope","$http","$log","youtubeService"];function e(e,o,t,n){r();function r(){e.youtube=n.getYoutube();e.results=n.getResults();e.history=n.getHistory();e.classHidden="hidden";e.classShown="shown";e.video_button=false;e.search_button=false;e.room_name="Room Name";e.room_description="Room Description";e.genre="Genre";e.artists="Artists";e.current_song="Current Song";e.song_title="Song Title";e.artist="Artist";e.room_recommendations="Room Recommendations"}e.launch=function(o,r){l();e.classHidden="shown";e.classShown="hidden";n.launchPlayer(o.id,o.title);if(r){n.archiveVideo(o)}t.info("Launched id:"+o.id+" and title:"+o.title)};e.nextPageToken="";e.label="You haven't searched for any video yet!";e.loading=false;e.search=function(r){i();e.classHidden="hidden";e.classShown="shown";e.loading=true;o.get("https://www.googleapis.com/youtube/v3/search",{params:{key:"AIzaSyBJmqwVRUJUXd2QZD1agSvI0B5DzYbiKuc",type:"video",maxResults:"10",pageToken:r?"":e.nextPageToken,part:"id,snippet",fields:"items/id,items/snippet/title,items/snippet/description,items/snippet/thumbnails/default,items/snippet/channelTitle,nextPageToken",q:this.query}}).success(function(o){if(o.items.length===0){e.label="No results were found!"}n.listResults(o,e.nextPageToken&&!r);e.nextPageToken=o.nextPageToken;t.info(o)}).error(function(){t.info("Search error")}).finally(function(){e.loadMoreButton.stopSpin();e.loadMoreButton.setDisabled(false);e.loading=false})};e.show_video=function(){l();console.log("show_video function called");e.classHidden="shown";e.classShown="hidden"};e.show_search=function(){i();console.log("show_search function called");e.classHidden="hidden";e.classShown="shown"};function i(){e.search_button=false;e.video_button=true}function l(){e.search_button=true;e.video_button=false}}})();(function(){angular.module("TuneBox").controller("roomcreationCtrl",e);e.$inject=["$scope","authentication","$location","roomService"];function e(e,o,t,n){if(!o.isLoggedIn()){t.path("/")}e.createRoom=function(){var r=o.getUserInfo().email;e.room.admin=r;var i=e.room.tags;var l=[];i.forEach(function(e){console.log(e);var o=false;if(l.length==0){l.push(e)}l.forEach(function(t){console.log("toka");if(e===t){console.log("found");o=true}});if(!o){l.push(e)}});console.log(l);e.room.tags=l;n.createRoom(e.room).success(function(e){t.path("/")}).error(function(e){console.log(e)})}}})();(function(){angular.module("TuneBox").controller("roomlistingCtrl",e);e.$inject=["$scope","authentication","$location","roomService"];function e(e,o,t,n){if(!o.isLoggedIn()){t.path("/")}var r=o.getUserInfo().email;n.getUserRooms(r).success(function(o){console.log(o);e.adminRooms=o});n.getPublicRooms().success(function(o){e.publicRooms=o})}})();(function(){angular.module("TuneBox").service("roomService",e);e.$inject=["$window","$http"];function e(e,o){var t=function(e){return o.post("api/createRoom",e).success(function(e){console.log(e)})};var n=function(e){console.log(e);return o.get("api/rooms/"+e).success(function(e){})};var r=function(){return o.get("api/rooms").success(function(e){})};var i=function(e){return o.get("api/room/"+e).success(function(e){})};return{createRoom:t,getUserRooms:n,getPublicRooms:r,getRoom:i}}})();(function(){angular.module("TuneBox").controller("roomCtrl",e);e.$inject=["$scope","authentication","$location","$routeParams","roomService"];function e(e,o,t,n,r){console.log("tsek");if(!o.isLoggedIn()){t.path("/")}console.log(n.roomid);var i;r.getRoom(n.roomid).success(function(o){console.log(o);i=o;e.room=i;console.log(e.room.roomName)})}})();