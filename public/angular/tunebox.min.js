var app=angular.module("TuneBox",["ngResource","ngRoute","ngFileUpload","ngImgCrop","ui.bootstrap"]);app.config(["$routeProvider",function(e){e.when("/",{templateUrl:"partials/index.view.html",controller:"homeCtrl"}).when("/browse",{templateUrl:"partials/browse.view.html",controller:"roomlistingCtrl"}).when("/register",{templateUrl:"partials/register.view.html",controller:"registerCtrl"}).when("/login",{templateUrl:"partials/login.view.html",controller:"loginCtrl"}).when("/room",{templateUrl:"partials/room.view.html",controller:"youtubeCtrl"}).when("/create-room",{templateUrl:"partials/create-room.html",controller:"roomcreationCtrl"}).when("/rooms",{templateUrl:"partials/rooms.html",controller:"roomlistingCtrl"}).when("/profile",{templateUrl:"partials/profile.view.html",controller:"profileCtrl"}).when("/room/:roomid",{templateUrl:"partials/room.view.html",controller:"roomCtrl"}).when("/room/edit/:roomId",{templateUrl:"partials/editRoom.view.html",controller:"editRoomCtrl"}).otherwise({redirectTo:"/"})}]);(function(){angular.module("TuneBox").controller("homeCtrl",e);e.$inject=["$scope","authentication"];function e(e,o){}})();(function(){angular.module("TuneBox").controller("registerCtrl",e);e.$inject=["$scope","authentication","$location","checkLogin"];function e(e,o,t,n){if(o.isLoggedIn()){t.path("/")}e.register=function(){o.register(e.user).success(function(e){n.showLoginUI();t.path("/")}).error(function(o){e.showError=true;e.error=o.message})}}})();(function(){angular.module("TuneBox").service("authentication",e);e.$inject=["$window","$http"];function e(e,o){var t=function(o){e.localStorage["tunebox-token"]=o};var n=function(){return e.localStorage["tunebox-token"]};var i=function(){e.localStorage.removeItem("tunebox-token")};var s=function(e){return o.post("api/login",e).success(function(e){t(e.token)})};var r=function(e){return o.post("api/register",e).success(function(e){t(e.token)})};var l=function(){var o=n();if(o){var t=JSON.parse(e.atob(o.split(".")[1]));return t.exp>Date.now()/1e3}else{return null}};var a=function(){if(l()){var o=n();var t=JSON.parse(e.atob(o.split(".")[1]));return t}else{return false}};var c=function(){var e=a();var o={_id:e._id,name:e.name,email:e.email,joined:e.joined,organization:e.organization,homePage:e.homePage,premium:e.premium,privateLimit:e.privateLimit,publicLimit:e.publicLimit,tags:e.tags,color:e.color};return o};return{saveToken:t,getToken:n,logout:i,login:s,register:r,isLoggedIn:l,getUserInfo:a,getUserObject:c}}})();(function(){angular.module("TuneBox").controller("loginCtrl",e);e.$inject=["$scope","authentication","$location","checkLogin"];function e(e,o,t,n){if(o.isLoggedIn()){t.path("/")}e.error="";e.login=function(){o.login(e.user).success(function(e){n.showLoginUI();t.path("/")}).error(function(o){e.error=o.message});e.hideError=function(){e.error=""}}}})();(function(){angular.module("TuneBox").controller("navigationCtrl",e);e.$inject=["$scope","authentication","checkLogin","$location"];function e(e,o,t,n){if(!o.isLoggedIn()){e.loginData=t.getAll()}else{e.loginData=t.getAll();t.showLoginUI()}e.logout_function=function(){console.log("logout function");o.logout();t.showLogoutUI();n.path("/")};e.user=o.getUserInfo()}})();(function(){angular.module("TuneBox").controller("profileCtrl",e);e.$inject=["$scope","authentication","$location","profileService","$timeout","$window"];function e(e,o,t,n,i,s){if(!o.isLoggedIn())t.path("/");e.user=o.getUserObject();e.original=angular.copy(o.getUserObject());e.$watch("user",function(){if(!angular.equals(e.original,e.user)){e.edited=true}else{e.edited=false}},true);e.editProfile=function(){e.editInfo=true};e.save=function(t){n.saveProfile(e.user).success(function(t){o.saveToken(t.token);e.showSuccess=true;r();i(function(){e.showSuccess=false},3e3)}).error(function(o){e.showError=true;e.error=o.message})};e.cancel=function(){r()};e.hideMessages=function(){e.showError=false;e.showSuccess=false};e.getPremium=function(){s.alert("This is a placeholder (The feature will be implemented later)")};var r=function(){e.showError=false;e.edited=false;e.editInfo=false;e.user=o.getUserObject();e.original=angular.copy(o.getUserObject())}}})();(function(){angular.module("TuneBox").service("profileService",e);e.$inject=["$http"];function e(e){var o=function(o){var t="/api/users/"+o._id;return e.put(t,o)};var t=function(o){return e.get("/api/users/"+o).success(function(e){})};var n=function(o){var t="/api/users/color/"+o._id;return e.put(t,o)};return{saveProfile:o,getProfile:t,saveUserColor:n}}})();(function(){angular.module("TuneBox").config(["$httpProvider",function(e){delete e.defaults.headers.common["X-Requested-With"]}]).service("youtubeService",e);e.$inject=["$window","$rootScope","$log","$timeout"];function e(e,o,t,n){var i=this;var s=document.createElement("script");s.src="https://www.youtube.com/iframe_api";var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(s,r);var l={ready:false,player:null,playerId:null,videoId:null,videoTitle:null,playerHeight:"100%",playerWidth:"100%",state:"stopped"};var a=[];var c=[];e.onYouTubeIframeAPIReady=function(){t.info("Youtube API is ready");l.ready=true;i.bindPlayer("placeholder");i.loadPlayer();o.$apply()};this.secondRun=function(){if(l.ready){console.log("Ready");i.bindPlayer("placeholder");i.loadPlayer();n(function(){t.info("TIMEOUT");o.$apply()},1e3)}else{console.log("Not ready")}};this.bindPlayer=function(e){t.info("Binding to "+e);l.playerId=e};this.createPlayer=function(){t.info("Creating a new Youtube player for DOM id "+l.playerId+" and video "+l.videoId);return new YT.Player(l.playerId,{height:l.playerHeight,width:l.playerWidth,playerVars:{rel:0,showinfo:0},events:{onReady:onPlayerReady,onStateChange:onPlayerStateChange,onError:onError}})};this.loadPlayer=function(){if(l.ready&&l.playerId){if(l.player){l.player.destroy()}l.player=i.createPlayer()}};this.launchPlayer=function(e,o){console.log("ID:"+e+" TITLE: "+o);l.player.loadVideoById(e);l.videoId=e;l.videoTitle=o;return l};this.launchPlaylist=function(e){console.log(e)};this.listResults=function(e,o){if(!o){a.length=0}for(var t=e.items.length-1;t>=0;t--){a.push({id:e.items[t].id.videoId,title:e.items[t].snippet.title,description:e.items[t].snippet.description,thumbnail:e.items[t].snippet.thumbnails.default.url,author:e.items[t].snippet.channelTitle})}a.reverse();return a};this.archiveVideo=function(e){c.unshift(e);return c};this.getYoutube=function(){return l};this.getResults=function(){return a};this.getHistory=function(){return c}}})();(function(){angular.module("TuneBox").controller("youtubeCtrl",e);e.$inject=["$scope","$http","$log","youtubeService"];function e(e,o,t,n){i();function i(){e.youtube=n.getYoutube();e.results=n.getResults();e.history=n.getHistory();e.classHidden="hidden";e.classShown="shown";e.video_button=false;e.search_button=false;e.room_name="Room Name";e.room_description="Room Description";e.genre="Genre";e.artists="Artists";e.current_song="Current Song";e.song_title="Song Title";e.artist="Artist";e.room_recommendations="Room Recommendations"}e.launch=function(o,i){r();e.classHidden="shown";e.classShown="hidden";n.launchPlayer(o.id,o.title);if(i){n.archiveVideo(o)}t.info("Launched id:"+o.id+" and title:"+o.title)};e.nextPageToken="";e.label="You haven't searched for any video yet!";e.loading=false;e.search=function(i){s();e.classHidden="hidden";e.classShown="shown";e.loading=true;o.get("https://www.googleapis.com/youtube/v3/search",{params:{key:"AIzaSyBJmqwVRUJUXd2QZD1agSvI0B5DzYbiKuc",type:"video",maxResults:"10",pageToken:i?"":e.nextPageToken,part:"id,snippet",fields:"items/id,items/snippet/title,items/snippet/description,items/snippet/thumbnails/default,items/snippet/channelTitle,nextPageToken",q:this.query}}).success(function(o){if(o.items.length===0){e.label="No results were found!"}n.listResults(o,e.nextPageToken&&!i);e.nextPageToken=o.nextPageToken;t.info(o)}).error(function(){t.info("Search error")}).finally(function(){e.loadMoreButton.stopSpin();e.loadMoreButton.setDisabled(false);e.loading=false})};e.show_video=function(){r();console.log("show_video function called");e.classHidden="shown";e.classShown="hidden"};e.show_search=function(){s();console.log("show_search function called");e.classHidden="hidden";e.classShown="shown"};function s(){e.search_button=false;e.video_button=true}function r(){e.search_button=true;e.video_button=false}}})();(function(){angular.module("TuneBox").controller("roomcreationCtrl",e);e.$inject=["$scope","authentication","$location","roomService"];function e(e,o,t,n){if(!o.isLoggedIn()){t.path("/")}e.createRoom=function(){var i=o.getUserInfo()._id;e.room.admin=i;console.log(e.room.userLimit);var s=e.room.tags;var r=n.filterDublicateTags(s);console.log(r);e.room.tags=r;n.createRoom(e.room).success(function(e){t.path("/browse")}).error(function(e){console.log(e)})}}})();(function(){angular.module("TuneBox").controller("roomlistingCtrl",e);e.$inject=["$scope","authentication","$location","roomService","$window"];function e(e,o,t,n,i){e.publicRoom=true;e.yourRoom=false;e.publicActive="room-type-selection-active";e.yourActive="";if(!o.isLoggedIn()){t.path("/")}var s=o.getUserInfo()._id;n.getUserRooms(s).success(function(o){console.log(o);e.adminRooms=o});e.goToRoom=function(e){console.log("Tääl");t.path("/room/"+e)};e.showPublicRooms=function(){e.publicRoom=true;e.yourRoom=false;e.publicActive="room-type-selection-active";e.yourActive=""};e.showYourRooms=function(){e.publicRoom=false;e.yourRoom=true;e.publicActive="";e.yourActive="room-type-selection-active"};n.getPublicRooms().success(function(o){e.publicRooms=o})}})();(function(){angular.module("TuneBox").service("roomService",e);e.$inject=["$window","$http"];function e(e,o){var t=function(e){return o.post("api/createRoom",e).success(function(e){console.log(e)})};var n=function(e){console.log(e);return o.get("api/rooms/"+e).success(function(e){})};var i=function(){return o.get("api/rooms").success(function(e){})};var s=function(e){return o.get("api/room/"+e).success(function(e){})};var r=function(e){var t="/api/room/"+e._id;return o.put(t,e)};var l=function(e){var o=[];e.forEach(function(e){var t=false;if(o.length==0)o.push(e);o.forEach(function(o){if(e===o){t=true}});if(!t){o.push(e)}});return o};var a=function(e){return o.post("api/saveMessage",e).success(function(e){})};var c=function(e){return o.get("api/getMessages/"+e).success(function(e){console.log(e)})};var u=function(e,t){console.log("SERVICE");console.log(t);return o.put("api/updateVideo/"+e,t).success(function(e){})};var d=function(e){return o.put("/api/togglePlaylist/"+e).success(function(e){})};return{createRoom:t,getUserRooms:n,getPublicRooms:i,getRoom:s,saveMessage:a,getMessages:c,changeVideo:u,editRoom:r,filterDublicateTags:l,togglePlaylist:d}}})();(function(){angular.module("TuneBox").controller("roomCtrl",e);e.$inject=["$scope","authentication","$location","$routeParams","roomService","$http","$log","youtubeService","$window","$sce","profileService"];function e(e,o,t,n,i,s,r,l,a,c,u){e.colorCollection=["#ff0000","#0066ff","#ff9900","#990099","#ff8000","#196619","#ff0080","#00ff99","#cc66ff","#ffff00"];e.selectedIndex=-1;e.userColor;var d=o.getUserObject();var g=u.getProfile(d._id).success(function(o){e.userColor=o.color;console.log("User color is:"+e.userColor)});console.log();e.dynamicPopover={templateUrl:"partials/chatSettingsPopoverTemplate.html",title:"Settings"};var f="#000";if(!o.isLoggedIn()){t.path("/")}e.isAdmin=false;var m=io();m.on("msg",function(e){if(e===n.roomid){p()}});m.on("changeVideo",function(e){if(e===n.roomid){y()}});l.secondRun();a.onPlayerReady=function(){console.log("ONPLAYERREADY "+n.roomid);h();var t;i.getRoom(n.roomid).success(function(n){console.log(n);t=n;e.room=t;console.log(e.room.roomName);u.getProfile(t.admin).success(function(t){e.admin=t;if(o.getUserObject()._id==e.room.admin){console.log("admin");e.isAdmin=true}else{console.log("not admin");e.isAdmin=false}});b(t.currentVideo,true);p()})};a.onPlayerStateChange=function(e){if(e.data==YT.PlayerState.ENDED){S()}};a.onError=function(e){console.log(e);S()};function h(){e.youtube=l.getYoutube();e.results=l.getResults();e.history=l.getHistory();e.classHidden="hidden";e.classShown="shown";e.video_button=false;e.search_button=false;e.current_song="Current Song";e.room_recommendations="Room Recommendations"}function p(){i.getMessages(n.roomid).success(function(o){e.messages=o})}function v(){i.getRoom(n.roomid).success(function(o){console.log(o);e.room=o;console.log(e.room.roomName)})}function w(e){i.changeVideo(n.roomid,e).success(function(e){m.emit("changeVideo",n.roomid)})}function y(){i.getRoom(n.roomid).success(function(e){console.log(e);vRoom=e;b(vRoom.currentVideo,true)})}function b(o,t){P();e.classHidden="shown";e.classShown="hidden";l.launchPlayer(o.id,o.title);if(t){l.archiveVideo(o)}e.currentVideo=o;r.info("Launched id:"+o.id+" and title:"+o.title)}function S(){var t=Math.floor(Math.random()*e.room.tags.length+1);var n=e.room.tags[t-1];console.log(n);var i=new Date;var l=i.getFullYear();i.setFullYear(l-2);console.log(i);var a=[];s.get("https://www.googleapis.com/youtube/v3/search",{params:{key:"AIzaSyBJmqwVRUJUXd2QZD1agSvI0B5DzYbiKuc",type:"video",publishedAfter:i,maxResults:"50",part:"id,snippet",q:"'"+n+"' song -'the best' -'vs'"}}).success(function(o){if(o.items.length===0){console.log("No results");return}console.log(o);var t=Math.floor(Math.random()*o.items.length+0);var n={};n.id=o.items[t].id.videoId;n.title=o.items[t].snippet.title;e.launch(n,true)}).error(function(){r.info("Search error")});if(o.getUserObject()._id==e.admin._id){var t=Math.floor(Math.random()*e.room.tags.length+1);var n=e.room.tags[t-1];console.log(n);var i=new Date;var l=i.getFullYear();i.setFullYear(l-2);console.log(i);var a=[];s.get("https://www.googleapis.com/youtube/v3/search",{params:{key:"AIzaSyBJmqwVRUJUXd2QZD1agSvI0B5DzYbiKuc",type:"video",publishedAfter:i,maxResults:"50",part:"id,snippet",q:"'"+n+"' song -'the best' -'vs'"}}).success(function(o){if(o.items.length===0){console.log("No results");return}console.log(o);var t=Math.floor(Math.random()*o.items.length+0);var n={};n.id=o.items[t].id.videoId;n.title=o.items[t].snippet.title;e.launch(n,true)}).error(function(){r.info("Search error")})}else{console.log("BACK OFF YO")}}e.launch=function(o,t){console.log(o);P();e.classHidden="shown";e.classShown="hidden";l.launchPlayer(o.id,o.title);if(t){l.archiveVideo(o)}e.currentVideo=o;w(o);r.info("Launched id:"+o.id+" and title:"+o.title)};e.nextPageToken="";e.label="You haven't searched for any video yet!";e.loading=false;e.search=function(o){R();e.classHidden="hidden";e.classShown="shown";e.loading=true;s.get("https://www.googleapis.com/youtube/v3/search",{params:{key:"AIzaSyBJmqwVRUJUXd2QZD1agSvI0B5DzYbiKuc",type:"video",maxResults:"10",pageToken:o?"":e.nextPageToken,part:"id,snippet",fields:"items/id,items/snippet/title,items/snippet/description,items/snippet/thumbnails/default,items/snippet/channelTitle,nextPageToken",q:this.query}}).success(function(t){if(t.items.length===0){e.label="No results were found!"}l.listResults(t,e.nextPageToken&&!o);e.nextPageToken=t.nextPageToken;r.info(t)}).error(function(){r.info("Search error")}).finally(function(){e.loadMoreButton.stopSpin();e.loadMoreButton.setDisabled(false);e.loading=false})};e.show_video=function(){P();console.log("show_video function called");e.classHidden="shown";e.classShown="hidden"};e.show_search=function(){R();console.log("show_search function called");e.classHidden="hidden";e.classShown="shown"};function R(){e.search_button=false;e.video_button=true}function P(){e.search_button=true;e.video_button=false}e.sendMessage=function(){if(e.message.message==null){console.log("No message")}else{e.message.sender=o.getUserObject().name;e.message.room=n.roomid;i.saveMessage(e.message).success(function(o){console.log(o);e.message.message=null;m.emit("msg",n.roomid)})}};e.isAdmin=function(){if(o.getUserObject()._id==e.room.admin){console.log("admin");return true}else{console.log("not admin");return false}};e.togglePlaylist=function(){i.togglePlaylist(n.roomid).success(function(o){console.log(o);e.room=o;if(o.playlist){var t=[];if(!o.playlistId){console.log("Please set a playlist")}else{s.get("https://www.googleapis.com/youtube/v3/playlistItems",{params:{key:"AIzaSyBJmqwVRUJUXd2QZD1agSvI0B5DzYbiKuc",type:"playlist",maxResults:"50",part:"snippet",playlistId:o.playlistId}}).success(function(e){if(e.items.length===0){console.log("No results");return}console.log(e)}).error(function(){r.info("Search error")})}}else{console.log("Toggled off")}})};e.getMessageColor=function(o,t){console.log("Chat color changed to "+o);f=o;e.selectedIndex=t;console.log("messageColor = "+f);I();g=u.getProfile(d._id).success(function(o){e.userColor=o.color;console.log("User color is:"+e.userColor)})};function I(){d.color=f;u.saveUserColor(d).success(function(e){}).error(function(e){console.log(e.message)})}}})();(function(){angular.module("TuneBox").controller("editRoomCtrl",e);e.$inject=["authentication","$location","$routeParams","roomService","$scope","$timeout"];function e(e,o,t,n,i,s){if(!e.isLoggedIn())o.path("/");n.getRoom(t.roomId).success(function(t){if(t.admin!==e.getUserObject()._id)o.path("/");i.room=t;i.original=angular.copy(t);i.edited=false;i.$watch("room",function(){if(!angular.equals(i.room,i.original)){i.edited=true}else{i.edited=false}},true)}).error(function(e){console.log(e)});i.save=function(){var e=n.filterDublicateTags(i.room.tags);i.room.tags=e;n.editRoom(i.room).success(function(e){i.room=e;i.original=angular.copy(e);i.edited=false;i.showError=false;i.showSuccess=true;s(function(){i.showSuccess=false},4e3)}).error(function(e){i.error=e.message;i.showError=true})};i.cancel=function(){o.path("/browse")};i.hideMessages=function(){i.showError=false;i.showSuccess=false}}})();(function(){angular.module("TuneBox").service("checkLogin",e);e.$inject=[];function e(){this.loginData={showLogin:false};this.getAll=function(){return this.loginData};this.setShowLogin=function(e){this.loginData.showLogin=e};this.showLogoutUI=function(){this.setShowLogin(false)};this.showLoginUI=function(){this.setShowLogin(true)}}})();(function(){angular.module("TuneBox").controller("roomCtrl",e);e.$inject=["$scope","authentication","$location","$routeParams","roomService","$http","$log","youtubeService","$window","$sce","profileService"];function e(e,o,t,n,i,s,r,l,a,c,u){e.colorCollection=["#ff0000","#0066ff","#ff9900","#990099","#ff8000","#196619","#ff0080","#00ff99","#cc66ff","#ffff00"];e.selectedIndex=-1;e.userColor;var d=o.getUserObject();var g=u.getProfile(d._id).success(function(o){e.userColor=o.color;console.log("User color is:"+e.userColor)});console.log();e.dynamicPopover={templateUrl:"partials/chatSettingsPopoverTemplate.html",title:"Settings"};var f="#000";if(!o.isLoggedIn()){t.path("/")}e.isAdmin=false;var m=io();m.on("msg",function(e){if(e===n.roomid){p()}});m.on("changeVideo",function(e){if(e===n.roomid){y()}});l.secondRun();a.onPlayerReady=function(){console.log("ONPLAYERREADY "+n.roomid);h();var t;i.getRoom(n.roomid).success(function(n){console.log(n);t=n;e.room=t;console.log(e.room.roomName);u.getProfile(t.admin).success(function(t){e.admin=t;if(o.getUserObject()._id==e.room.admin){console.log("admin");e.isAdmin=true}else{console.log("not admin");e.isAdmin=false}});b(t.currentVideo,true);p()})};a.onPlayerStateChange=function(e){if(e.data==YT.PlayerState.ENDED){S()}};a.onError=function(e){console.log(e);S()};function h(){e.youtube=l.getYoutube();e.results=l.getResults();e.history=l.getHistory();e.classHidden="hidden";e.classShown="shown";e.video_button=false;e.search_button=false;e.current_song="Current Song";e.room_recommendations="Room Recommendations"}function p(){i.getMessages(n.roomid).success(function(o){e.messages=o})}function v(){i.getRoom(n.roomid).success(function(o){console.log(o);e.room=o;console.log(e.room.roomName)})}function w(e){i.changeVideo(n.roomid,e).success(function(e){m.emit("changeVideo",n.roomid)})}function y(){i.getRoom(n.roomid).success(function(e){console.log(e);vRoom=e;b(vRoom.currentVideo,true)})}function b(o,t){P();e.classHidden="shown";e.classShown="hidden";l.launchPlayer(o.id,o.title);if(t){l.archiveVideo(o)}e.currentVideo=o;r.info("Launched id:"+o.id+" and title:"+o.title)}function S(){var t=Math.floor(Math.random()*e.room.tags.length+1);var n=e.room.tags[t-1];console.log(n);var i=new Date;var l=i.getFullYear();i.setFullYear(l-2);console.log(i);var a=[];s.get("https://www.googleapis.com/youtube/v3/search",{params:{key:"AIzaSyBJmqwVRUJUXd2QZD1agSvI0B5DzYbiKuc",type:"video",publishedAfter:i,maxResults:"50",part:"id,snippet",q:"'"+n+"' song -'the best' -'vs'"}}).success(function(o){if(o.items.length===0){console.log("No results");return}console.log(o);var t=Math.floor(Math.random()*o.items.length+0);var n={};n.id=o.items[t].id.videoId;n.title=o.items[t].snippet.title;e.launch(n,true)}).error(function(){r.info("Search error")});if(o.getUserObject()._id==e.admin._id){var t=Math.floor(Math.random()*e.room.tags.length+1);var n=e.room.tags[t-1];console.log(n);var i=new Date;var l=i.getFullYear();i.setFullYear(l-2);console.log(i);var a=[];s.get("https://www.googleapis.com/youtube/v3/search",{params:{key:"AIzaSyBJmqwVRUJUXd2QZD1agSvI0B5DzYbiKuc",type:"video",publishedAfter:i,maxResults:"50",part:"id,snippet",q:"'"+n+"' song -'the best' -'vs'"}}).success(function(o){if(o.items.length===0){console.log("No results");return}console.log(o);var t=Math.floor(Math.random()*o.items.length+0);var n={};n.id=o.items[t].id.videoId;n.title=o.items[t].snippet.title;e.launch(n,true)}).error(function(){r.info("Search error")})}else{console.log("BACK OFF YO")}}e.launch=function(o,t){console.log(o);P();e.classHidden="shown";e.classShown="hidden";l.launchPlayer(o.id,o.title);if(t){l.archiveVideo(o)}e.currentVideo=o;w(o);r.info("Launched id:"+o.id+" and title:"+o.title)};e.nextPageToken="";e.label="You haven't searched for any video yet!";e.loading=false;e.search=function(o){R();e.classHidden="hidden";e.classShown="shown";e.loading=true;s.get("https://www.googleapis.com/youtube/v3/search",{params:{key:"AIzaSyBJmqwVRUJUXd2QZD1agSvI0B5DzYbiKuc",type:"video",maxResults:"10",pageToken:o?"":e.nextPageToken,part:"id,snippet",fields:"items/id,items/snippet/title,items/snippet/description,items/snippet/thumbnails/default,items/snippet/channelTitle,nextPageToken",q:this.query}}).success(function(t){if(t.items.length===0){e.label="No results were found!"}l.listResults(t,e.nextPageToken&&!o);e.nextPageToken=t.nextPageToken;r.info(t)}).error(function(){r.info("Search error")}).finally(function(){e.loadMoreButton.stopSpin();e.loadMoreButton.setDisabled(false);e.loading=false})};e.show_video=function(){P();console.log("show_video function called");e.classHidden="shown";e.classShown="hidden"};e.show_search=function(){R();console.log("show_search function called");e.classHidden="hidden";e.classShown="shown"};function R(){e.search_button=false;e.video_button=true}function P(){e.search_button=true;e.video_button=false}e.sendMessage=function(){if(e.message.message==null){console.log("No message")}else{e.message.sender=o.getUserObject().name;e.message.room=n.roomid;i.saveMessage(e.message).success(function(o){console.log(o);e.message.message=null;m.emit("msg",n.roomid)})}};e.isAdmin=function(){if(o.getUserObject()._id==e.room.admin){console.log("admin");return true}else{console.log("not admin");return false}};e.togglePlaylist=function(){i.togglePlaylist(n.roomid).success(function(o){console.log(o);e.room=o;if(o.playlist){var t=[];if(!o.playlistId){console.log("Please set a playlist")}else{s.get("https://www.googleapis.com/youtube/v3/playlistItems",{params:{key:"AIzaSyBJmqwVRUJUXd2QZD1agSvI0B5DzYbiKuc",type:"playlist",maxResults:"50",part:"snippet",playlistId:o.playlistId}}).success(function(e){if(e.items.length===0){console.log("No results");return}console.log(e)}).error(function(){r.info("Search error")})}}else{console.log("Toggled off")}})};e.getMessageColor=function(o,t){console.log("Chat color changed to "+o);f=o;e.selectedIndex=t;console.log("messageColor = "+f);I();g=u.getProfile(d._id).success(function(o){e.userColor=o.color;console.log("User color is:"+e.userColor)})};function I(){d.color=f;u.saveUserColor(d).success(function(e){}).error(function(e){console.log(e.message)})}}})();(function(){angular.module("TuneBox").controller("uploadCtrl",e);e.$inject=["$scope","Upload","$timeout"];function e(e,o,t){e.upload=function(n,i){e.room.thumbnail=n;o.upload({url:"api/uploads",data:{file:o.dataUrltoBlob(n,i)}}).then(function(o){t(function(){e.result=o.data})},function(o){if(o.status>0)e.errorMsg=o.status+": "+o.data},function(o){e.progress=parseInt(100*o.loaded/o.total)})}}})();